---
title: shell语法
tags: shell linux
---

### 变量使用
- 定义变量时，变量名不加美元符号;变量名和等号之间不能有空格
- 使用一个定义过的变量，只要在变量名前面加美元符号即可
- 变量名外面的花括号是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界
- 使用 readonly 命令可以将变量定义为只读变量，只读变量的值不能被改变。
  ```
    #!/bin/bash
    myUrl="http://www.google.com"
    readonly myUrl (or 一次性操作 readonly myUrl="http://www.google.com")
    myUrl="http://www.runoob.com"
  ```
 
### 删除变量
```     
  使用 unset 命令可以删除变量。语法：
  unset variable_name
  unset 命令不能删除只读变量
```   
### 变量类型
```     
运行shell时，会同时存在三种变量：
1) 局部变量 
   局部变量在脚本或命令中定义，仅在当前shell实例中有效，其他shell启动的程序不能访问局部变量。
2) 环境变量 
   所有的程序，包括shell启动的程序，都能访问环境变量，有些程序需要环境变量来保证其正常运行。
   必要的时候shell脚本也可以定义环境变量。
3) shell变量 
   shell变量是由shell程序设置的特殊变量。shell变量中有一部分是环境变量，有一部分是局部变量，这些变量保证了shell的正常运行  
                
```      
#### 字符串
```
- 单引号字符串的限制：
  单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的；
  单引号字串中不能出现单引号（对单引号使用转义符后也不行）。
- 双引号里可以有变量
- 双引号里可以出现转义字符  
```
#### 字符串操作
```
- 获取字符串长度(#string)
  string="abcd"
- 提取子字符串(string:开始位置：长度)</h5>
  string="great"
  echo ${string:1:2} # 输出 re
```
#### Shell 数组
- 定义数组
```
    在 Shell 中，用括号来表示数组，数组元素用"空格"符号分割开。定义数组的一般形式为：
    数组名=(值1 值2 ... 值n)
    还可以单独定义数组的各个分量：
        array_name[0]=value0
        array_name[1]=value1
        array_name[n]=valuen
    可以不使用连续的下标，而且下标的范围没有限制。
```
- 提取数组 ${数组名[下标]}
```
${数组名[下标]}
使用 @ 符号可以获取数组中的所有元素，例如：
echo ${array_name[@]}
# 取得数组元素的个数
length=${#array_name[@]}
# 或者
length=${#array_name[*]}
# 取得数组单个元素的长度
lengthn=${#array_name[n]}
```

### 基本运算符

```
- 原生bash不支持简单的数学运算，但是可以通过其他命令来实现，例如 awk 和 expr，expr 最常用。
- expr 是一款表达式计算工具，使用它能完成表达式的求值操作。
- 表达式和运算符之间要有空格，例如 2+2 是不对的，必须写成 2 + 2，这与我们熟悉的大多数编程语言不一样。
- 完整的表达式要被 ` ` 包含
- 乘号(*)前边必须加反斜杠(\)才能实现乘法运算； 
  - 在 MAC 中 shell 的 expr 语法是：$((表达式))，此处表达式中的 "*" 不需要转义符号 "\" 。 

  下表列出了常用的算术运算符，假定变量 a 为 10，变量 b 为 20：

  运算符    说明                举例
  +	      加法	    `expr $a + $b` 结果为 30。
  -	      减法	    `expr $a - $b` 结果为 -10。
  *	      乘法	    `expr $a \* $b` 结果为  200。
  /	      除法	    `expr $b / $a` 结果为 2。
  %	      取余	    `expr $b % $a` 结果为 0。
  =	      赋值	     a=$b 将把变量 b 的值赋给 a。
  ==      相等      用于比较两个数字，相同则返回 true。	[ $a == $b ] 返回 false。
  !=      不相等    用于比较两个数字，不相同则返回 true。	[ $a != $b ] 返回 true。
  注意：条件表达式要放在方括号之间，并且要有空格，例如: [$a==$b] 是错误的，必须写成 [ $a == $b ]。

```

### 关系运算符

```
关系运算符只支持数字，不支持字符串，除非字符串的值是数字。

下表列出了常用的关系运算符，假定变量 a 为 10，变量 b 为 20：

运算符	      说明	                                                    举例
-eq	      检测两个数是否相等，相等返回 true。	                 [ $a -eq $b ] 返回 false。
-ne	      检测两个数是否不相等，不相等返回 true。               [ $a -ne $b ] 返回 true。
-gt	      检测左边的数是否大于右边的，如果是，则返回 true。       [ $a -gt $b ] 返回 false。
-lt	      检测左边的数是否小于右边的，如果是，则返回 true。       [ $a -lt $b ] 返回 true。
-ge	      检测左边的数是否大于等于右边的，如果是，则返回 true。   [ $a -ge $b ] 返回 false。
-le	      检测左边的数是否小于等于右边的，如果是，则返回 true。	  [ $a -le $b ] 返回 true。
```

### 布尔运算符

```
下表列出了常用的布尔运算符，假定变量 a 为 10，变量 b 为 20：

运算符	    说明	                  举例
!           非运算      表达式为 true 则返回 false，否则返回 true。	[ ! false ] 返回 true。
-o	    或运算      有一个表达式为 true 则返回 true。	[ $a -lt 20 -o $b -gt 100 ] 返回 true。
-a	    与运算      两个表达式都为 true 才返回 true。	[ $a -lt 20 -a $b -gt 100 ] 返回 false。
```

### 逻辑运算符
```
以下介绍 Shell 的逻辑运算符，假定变量 a 为 10，变量 b 为 20:

运算符    	说明    	          举例
&&	      逻辑的 AND	    [[ $a -lt 100 && $b -gt 100 ]] 返回 false
||	      逻辑的 OR	      [[ $a -lt 100 || $b -gt 100 ]] 返回 true    
```

### 字符串运算符
```
下表列出了常用的字符串运算符，假定变量 a 为 "abc"，变量 b 为 "efg"：

  运算符	  说明	                                    举例
  =	      检测两个字符串是否相等，相等返回 true。	    [ $a = $b ] 返回 false。
  !=	    检测两个字符串是否相等，不相等返回 true。 	[ $a != $b ] 返回 true。
  -z	    检测字符串长度是否为0，为0返回 true。	      [ -z $a ] 返回 false。
  -n	    检测字符串长度是否为0，不为0返回 true。	    [ -n "$a" ] 返回 true。
  str	    检测字符串是否为空，不为空返回 true。	      [ $a ] 返回 true。  
```
### 文件测试运算符
```
文件测试运算符用于检测 Unix 文件的各种属性。

  属性检测描述如下：
  
  操作符	      说明	                                                               举例
  -b file	检测文件是否是块设备文件，如果是，则返回 true。	                     [ -b $file ] 返回 false。
  -c file	检测文件是否是字符设备文件，如果是，则返回 true。	                     [ -c $file ] 返回 false。
  -d file	检测文件是否是目录，如果是，则返回 true。	                             [ -d $file ] 返回 false。
  -f file	检测文件是否是普通文件（既不是目录，也不是设备文件），如果是，则返回 true。      [ -f $file ] 返回 true。
  -g file	检测文件是否设置了 SGID 位，如果是，则返回 true。	                      [ -g $file ] 返回 false。
  -k file	检测文件是否设置了粘着位(Sticky Bit)，如果是，则返回 true。 	              [ -k $file ] 返回 false。
  -p file	检测文件是否是有名管道，如果是，则返回 true。	                              [ -p $file ] 返回 false。
  -u file	检测文件是否设置了 SUID 位，如果是，则返回 true。                           [ -u $file ] 返回 false。
  -r file	检测文件是否可读，如果是，则返回 true。	                              [ -r $file ] 返回 true。
  -w file	检测文件是否可写，如果是，则返回 true。	                              [ -w $file ] 返回 true。
  -x file	检测文件是否可执行，如果是，则返回 true。                                   [ -x $file ] 返回 true。
  -s file	检测文件是否为空（文件大小是否大于0），不为空返回 true。	              [ -s $file ] 返回 true。
  -e file	检测文件（包括目录）是否存在，如果是，则返回 true。	                      [ -e $file ] 返回 true。 
```
### function

```
 [ function ] funname [()]
  {
      action;
      [return int;]  
  }
  1、可以带function fun() 定义，也可以直接fun() 定义,不带任何参数。
  2、参数返回，可以显示加：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。 return后跟数值n(0-255)
  3、函数返回值在调用该函数后通过 $? 来获得。
    注意：所有函数在使用前必须定义。这意味着必须将函数放在脚本开始部分，直至shell解释器首次发现它时，才可以使用。
    调用函数仅使用其函数名即可。
  4、在Shell中，调用函数时可以向其传递参数。在函数体内部，通过 $n 的形式来获取参数的值;
    注意，$10 不能获取第十个参数，获取第十个参数需要${10}。当n>=10时，需要使用${n}来获取参数。
```
### 多行注释
```
:<<EOF
    注释内容...
    注释内容...
    注释内容...
EOF

EOF 也可以使用其他符号:
                            
:<<'
注释内容...
注释内容...
注释内容...
'

:<<!
注释内容...
注释内容...
注释内容...
!
```
